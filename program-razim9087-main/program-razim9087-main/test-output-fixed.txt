
> OTC_Options_v1@0.0.0 anchor-test
> cd anchor && anchor test

warning: unexpected `cfg` condition value: `custom-heap`
  --> programs/basic/src/lib.rs:11:1
   |
11 | #[program]
   | ^^^^^^^^^^
   |
   = note: expected values for `feature` are: `cpi`, `default`, `idl-build`, `no-entrypoint`, `no-idl`, and `no-log-ix-name`
   = help: consider adding `custom-heap` as a feature in `Cargo.toml`
   = note: see <https://doc.rust-lang.org/nightly/rustc/check-cfg/cargo-specifics.html> for more information about checking conditional configuration
   = note: `#[warn(unexpected_cfgs)]` on by default
   = note: this warning originates in the macro `$crate::custom_heap_default` which comes from the expansion of the attribute macro `program` (in Nightly builds, run with -Z macro-backtrace for more info)

warning: unexpected `cfg` condition value: `custom-panic`
  --> programs/basic/src/lib.rs:11:1
   |
11 | #[program]
   | ^^^^^^^^^^
   |
   = note: expected values for `feature` are: `cpi`, `default`, `idl-build`, `no-entrypoint`, `no-idl`, and `no-log-ix-name`
   = help: consider adding `custom-panic` as a feature in `Cargo.toml`
   = note: see <https://doc.rust-lang.org/nightly/rustc/check-cfg/cargo-specifics.html> for more information about checking conditional configuration
   = note: this warning originates in the macro `$crate::custom_panic_default` which comes from the expansion of the attribute macro `program` (in Nightly builds, run with -Z macro-backtrace for more info)

warning: unexpected `cfg` condition value: `anchor-debug`
  --> programs/basic/src/lib.rs:11:1
   |
11 | #[program]
   | ^^^^^^^^^^
   |
   = note: expected values for `feature` are: `cpi`, `default`, `idl-build`, `no-entrypoint`, `no-idl`, and `no-log-ix-name`
   = help: consider adding `anchor-debug` as a feature in `Cargo.toml`
   = note: see <https://doc.rust-lang.org/nightly/rustc/check-cfg/cargo-specifics.html> for more information about checking conditional configuration
   = note: this warning originates in the attribute macro `program` (in Nightly builds, run with -Z macro-backtrace for more info)

warning: unexpected `cfg` condition value: `anchor-debug`
  --> programs/basic/src/lib.rs:11:1
   |
11 | #[program]
   | ^^^^^^^^^^
   |
   = note: expected values for `feature` are: `cpi`, `default`, `idl-build`, `no-entrypoint`, `no-idl`, and `no-log-ix-name`
   = help: consider adding `anchor-debug` as a feature in `Cargo.toml`
   = note: see <https://doc.rust-lang.org/nightly/rustc/check-cfg/cargo-specifics.html> for more information about checking conditional configuration
   = note: this warning originates in the derive macro `Accounts` (in Nightly builds, run with -Z macro-backtrace for more info)

warning: unexpected `cfg` condition value: `anchor-debug`
   --> programs/basic/src/lib.rs:363:10
    |
363 | #[derive(Accounts)]
    |          ^^^^^^^^
    |
    = note: expected values for `feature` are: `cpi`, `default`, `idl-build`, `no-entrypoint`, `no-idl`, and `no-log-ix-name`
    = help: consider adding `anchor-debug` as a feature in `Cargo.toml`
    = note: see <https://doc.rust-lang.org/nightly/rustc/check-cfg/cargo-specifics.html> for more information about checking conditional configuration
    = note: this warning originates in the derive macro `Accounts` (in Nightly builds, run with -Z macro-backtrace for more info)

warning: unexpected `cfg` condition value: `anchor-debug`
   --> programs/basic/src/lib.rs:378:10
    |
378 | #[derive(Accounts)]
    |          ^^^^^^^^
    |
    = note: expected values for `feature` are: `cpi`, `default`, `idl-build`, `no-entrypoint`, `no-idl`, and `no-log-ix-name`
    = help: consider adding `anchor-debug` as a feature in `Cargo.toml`
    = note: see <https://doc.rust-lang.org/nightly/rustc/check-cfg/cargo-specifics.html> for more information about checking conditional configuration
    = note: this warning originates in the derive macro `Accounts` (in Nightly builds, run with -Z macro-backtrace for more info)

warning: unexpected `cfg` condition value: `anchor-debug`
   --> programs/basic/src/lib.rs:392:10
    |
392 | #[derive(Accounts)]
    |          ^^^^^^^^
    |
    = note: expected values for `feature` are: `cpi`, `default`, `idl-build`, `no-entrypoint`, `no-idl`, and `no-log-ix-name`
    = help: consider adding `anchor-debug` as a feature in `Cargo.toml`
    = note: see <https://doc.rust-lang.org/nightly/rustc/check-cfg/cargo-specifics.html> for more information about checking conditional configuration
    = note: this warning originates in the derive macro `Accounts` (in Nightly builds, run with -Z macro-backtrace for more info)

warning: unexpected `cfg` condition value: `anchor-debug`
   --> programs/basic/src/lib.rs:406:10
    |
406 | #[derive(Accounts)]
    |          ^^^^^^^^
    |
    = note: expected values for `feature` are: `cpi`, `default`, `idl-build`, `no-entrypoint`, `no-idl`, and `no-log-ix-name`
    = help: consider adding `anchor-debug` as a feature in `Cargo.toml`
    = note: see <https://doc.rust-lang.org/nightly/rustc/check-cfg/cargo-specifics.html> for more information about checking conditional configuration
    = note: this warning originates in the derive macro `Accounts` (in Nightly builds, run with -Z macro-backtrace for more info)

warning: unexpected `cfg` condition value: `anchor-debug`
   --> programs/basic/src/lib.rs:455:10
    |
455 | #[derive(Accounts)]
    |          ^^^^^^^^
    |
    = note: expected values for `feature` are: `cpi`, `default`, `idl-build`, `no-entrypoint`, `no-idl`, and `no-log-ix-name`
    = help: consider adding `anchor-debug` as a feature in `Cargo.toml`
    = note: see <https://doc.rust-lang.org/nightly/rustc/check-cfg/cargo-specifics.html> for more information about checking conditional configuration
    = note: this warning originates in the derive macro `Accounts` (in Nightly builds, run with -Z macro-backtrace for more info)

warning: unexpected `cfg` condition value: `anchor-debug`
   --> programs/basic/src/lib.rs:483:10
    |
483 | #[derive(Accounts)]
    |          ^^^^^^^^
    |
    = note: expected values for `feature` are: `cpi`, `default`, `idl-build`, `no-entrypoint`, `no-idl`, and `no-log-ix-name`
    = help: consider adding `anchor-debug` as a feature in `Cargo.toml`
    = note: see <https://doc.rust-lang.org/nightly/rustc/check-cfg/cargo-specifics.html> for more information about checking conditional configuration
    = note: this warning originates in the derive macro `Accounts` (in Nightly builds, run with -Z macro-backtrace for more info)

warning: unexpected `cfg` condition value: `anchor-debug`
   --> programs/basic/src/lib.rs:526:10
    |
526 | #[derive(Accounts)]
    |          ^^^^^^^^
    |
    = note: expected values for `feature` are: `cpi`, `default`, `idl-build`, `no-entrypoint`, `no-idl`, and `no-log-ix-name`
    = help: consider adding `anchor-debug` as a feature in `Cargo.toml`
    = note: see <https://doc.rust-lang.org/nightly/rustc/check-cfg/cargo-specifics.html> for more information about checking conditional configuration
    = note: this warning originates in the derive macro `Accounts` (in Nightly builds, run with -Z macro-backtrace for more info)

warning: `basic` (lib) generated 16 warnings (5 duplicates)
    Finished `release` profile [optimized] target(s) in 0.35s
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.16s
     Running unittests src/lib.rs (/workspaces/OTC-Options/OTC_Options_v1/anchor/target/debug/deps/basic-34dabc418cb26632)

Found a 'test' script in the Anchor.toml. Running it as a test suite!

Running test suite: "/workspaces/OTC-Options/OTC_Options_v1/anchor/Anchor.toml"

Error: websocket error
(node:54653) [MODULE_TYPELESS_PACKAGE_JSON] Warning: Module type of file:///workspaces/OTC-Options/OTC_Options_v1/anchor/tests/basic.test.ts is not specified and it doesn't parse as CommonJS.
Reparsing as ES module because module syntax was detected. This incurs a performance overhead.
To eliminate this warning, add "type": "module" to /workspaces/OTC-Options/OTC_Options_v1/package.json.
(Use `node --trace-warnings ...` to show where the warning was created)


  OTC Options Trading
    User Account Initialization
      ✔ should initialize buyer user account (410ms)
      ✔ should initialize seller user account (406ms)
    Escrow Initialization and Deposits
      ✔ should initialize buyer escrow (422ms)
      ✔ should initialize seller escrow (418ms)
      ✔ should deposit to buyer escrow (421ms)
      ✔ should deposit to seller escrow (410ms)
      ✔ should fail to deposit zero amount
    Call Option - In The Money (ITM)
      ✔ should create a call option contract (389ms)
      ✔ should exercise the ITM call option (415ms)
      1) should settle the call option
    Call Option - Out of The Money (OTM)
      ✔ should create an OTM call option contract (383ms)
      ✔ should exercise the OTM call option with zero profit (411ms)
    Put Option - In The Money (ITM)
      ✔ should create a put option contract (412ms)
      ✔ should exercise the ITM put option (406ms)
      2) should settle the put option
    Put Option - Out of The Money (OTM)
      ✔ should create an OTM put option contract (387ms)
      ✔ should exercise the OTM put option with zero profit (415ms)
    Withdraw Functionality
      ✔ should allow buyer to withdraw from escrow (410ms)
      ✔ should allow seller to withdraw from escrow (408ms)
    Error Cases
      ✔ should fail when non-buyer tries to exercise (434ms)
      ✔ should fail to settle before exercise (432ms)
    Contract Tracking
      ✔ should track contracts in user accounts
      ✔ should have correct contract count for buyer


  21 passing (8s)
  2 failing

  1) OTC Options Trading
       Call Option - In The Money (ITM)
         should settle the call option:
     Error: AnchorError thrown in programs/basic/src/lib.rs:281. Error Code: InsufficientSellerEscrow. Error Number: 6006. Error Message: Seller escrow has insufficient funds for settlement.
      at Function.parse (/workspaces/OTC-Options/OTC_Options_v1/node_modules/@coral-xyz/anchor/src/error.ts:152:14)
      at translateError (/workspaces/OTC-Options/OTC_Options_v1/node_modules/@coral-xyz/anchor/src/error.ts:277:35)
      at MethodsBuilder.rpc [as _rpcFn] (/workspaces/OTC-Options/OTC_Options_v1/node_modules/@coral-xyz/anchor/src/program/namespace/rpc.ts:35:29)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async Context.<anonymous> (file:///workspaces/OTC-Options/OTC_Options_v1/anchor/tests/basic.test.ts:269:7)

  2) OTC Options Trading
       Put Option - In The Money (ITM)
         should settle the put option:
     Error: AnchorError thrown in programs/basic/src/lib.rs:281. Error Code: InsufficientSellerEscrow. Error Number: 6006. Error Message: Seller escrow has insufficient funds for settlement.
      at Function.parse (/workspaces/OTC-Options/OTC_Options_v1/node_modules/@coral-xyz/anchor/src/error.ts:152:14)
      at translateError (/workspaces/OTC-Options/OTC_Options_v1/node_modules/@coral-xyz/anchor/src/error.ts:277:35)
      at MethodsBuilder.rpc [as _rpcFn] (/workspaces/OTC-Options/OTC_Options_v1/node_modules/@coral-xyz/anchor/src/program/namespace/rpc.ts:35:29)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async Context.<anonymous> (file:///workspaces/OTC-Options/OTC_Options_v1/anchor/tests/basic.test.ts:433:7)



